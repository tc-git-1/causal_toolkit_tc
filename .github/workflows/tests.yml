# ==============================================================================
# SUMMARY: Continuous Integration (CI) Workflow for Automated Testing
# ==============================================================================
# This workflow automatically runs your test suite whenever code is updated.
# It ensures that new changes do not break existing functionality by:
# 1. Triggering on pushes to main/develop or Pull Requests to main.
# 2. Setting up a fresh Ubuntu environment with Python 3.11.
# 3. Installing your package (causal_toolkit_tc) and testing dependencies.
# 4. Running pytest with code coverage reporting.
# ==============================================================================

name: Tests                                     # Defines the name of the workflow as it appears in the GitHub Actions UI

on:                                             # definitions for when this workflow should run (triggers)
  push:                                         # Trigger the workflow when a commit is pushed...
    branches: [ main, develop ]                 # ...but only if the push is to the 'main' or 'develop' branches
  pull_request:                                 # Trigger the workflow when a Pull Request is opened or updated...
    branches: [ main ]                          # ...but only if the PR targets the 'main' branch

jobs:                                           # The grouping of all tasks (jobs) to be performed in this workflow
  test:                                         # Defines a specific job ID named 'test'
    runs-on: ubuntu-latest                      # Specifies that this job runs on the latest available Ubuntu Linux runner
    strategy:                                   # Configures the test matrix strategy (allows running multiple variations)
      fail-fast: false                          # If one version in the matrix fails, do NOT cancel the others immediately
      matrix:                                   # Defines the different configurations to run
        python-version: ["3.11"]                # A list of Python versions to test against (currently only 3.11)

    steps:                                      # The sequence of individual steps to execute within this job
    - uses: actions/checkout@v4                 # Uses the official Checkout action to download your repository code to the runner
    
    - name: Set up Python ${{ matrix.python-version }}  # Names this step dynamically based on the current matrix version
      uses: actions/setup-python@v5             # Uses the official Setup-Python action to install Python tools
      with:                                     # Provides input parameters to the setup-python action
        python-version: ${{ matrix.python-version }}  # Tells the action to install the specific version defined in the matrix

    - name: Install dependencies                # Names the step that installs your project and libraries
      run: |                                    # Starts a multi-line shell command block
        python -m pip install --upgrade pip     # Updates the pip installer to the latest version to avoid warnings
        pip install -e .                        # Installs YOUR package in "editable" mode so changes are reflected immediately
        pip install pytest pytest-cov           # Installs the testing framework (pytest) and the coverage tool (pytest-cov)
    
    - name: Run tests                           # Names the final step that actually executes the tests
      run: |                                    # Starts the command block for running tests
        pytest tests/ -v --cov=causal_toolkit_tc --cov-report=term-missing  # Runs pytest on 'tests/' folder, verbose mode, tracking coverage for your package